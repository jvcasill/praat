######################################################################
#### Robert Felty <robfelty - umich.edu>
#### 2006
#### This script comes with no warranty. Use at your own risk

## this script loops over a directory which contain all sound files,
## and for each file, it opens it up, makes a spectrogram, and allows
## the user to annotate it with a text grid, and the annotation is displayed 
## with the spectrogram along with the intensity contour and a pitch contour
## currently, the picture is simply copied to the clipboard, but it could also 
## be written to an .eps file, or the textgrid could be written to a text grid 
## file, to be used for later processing

######################################################################

#where to look for files -- include final slash
indir$ = "/Users/robfelty/Desktop/quilt/sound/"
Create Strings as file list... list 'indir$'*
numFiles = Get number of strings

#can change nextFileNum if you want to start later in the directory - 
#files are ordered in ASCII style (i.e. case-sensitive)
nextFileNum = 1


for i from nextFileNum to numFiles

  #get name of selected sound
  select Strings list
  currentFile$ = Get string... 'i'
  Read from file... 'indir$''currentFile$'

  word$ = selected$ ("Sound")
  
  Erase all
  Select outer viewport... 0 8 0 3
  Text top... yes 'word$'
  Draw... 0 0 0 0 no curve
  Select outer viewport... 0 8 1.75 6.5
  select Sound 'word$'
  To Spectrogram... 0.005 5000 0.002 20 Gaussian
  Paint... 0 0 0 0 100 yes 40 6 0 no

  select Sound 'word$'
  To TextGrid... spell 

  
  Marks left... 6 yes yes no
  Text left... yes spectrogram (Hz)
  #Text right... yes pitch (Hz)

  #select Sound 'word$'
  #To Pitch... 0 75 600
  #select Pitch 'word$'

  #Speckle... 0 0 0 500 no
  #Marks right... 6 yes yes no
  #select Sound 'word$'
  #To Intensity... 100 0 yes
  #Draw... 0 0 0 0 no
  #  select Pitch 'word$'
  # Speckle... 0 0 0 500 no
  #Erase all
  #Speckle... 0 0 0 500 no   
  select Sound 'word$'
  To TextGrid... spell 
  select TextGrid 'word$'
  plus Sound 'word$'
  Edit
  pause ready to draw?
  select TextGrid 'word$'
  Select outer viewport... 0 8 0 8
  Draw... 0 0 yes yes yes
  Copy to clipboard
  #plus Intensity 'word$'
  #plus Pitch 'word$'
  #plus Spectrogram 'word$'
  #Remove
  pause copy to word
  printline 'i'
endfor
